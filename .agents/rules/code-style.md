# Rule: Code Style

## Formatting (Biome)

### Basic Rules

- **Indentation**: 2 spaces
- **Quotes**: Single quotes for JS/TS, double quotes for JSX
- **Semicolons**: Always
- **Line width**: 160 characters
- **Trailing commas**: ES5 style
- **Arrow parentheses**: Always
- **JSX quotes**: Double quotes

### Auto-formatting

Biome handles formatting automatically:
- On save (if editor configured)
- Pre-commit (via lint-staged)
- Via `pnpm lint:fix`

### EditorConfig

Project uses `.editorconfig` - ensure editor respects it.

## TypeScript Conventions

### Type Imports

Always use `import type` for type-only imports:

**✅ Good:**
```typescript
import type { ReactNode } from 'react';
import { useState } from 'react';
```

**❌ Bad:**
```typescript
import { ReactNode, useState } from 'react';
```

### Strictness

TypeScript strict mode enabled:
- `strict: true` in tsconfig.json
- `noUnusedLocals`, `noUnusedParameters` enabled
- `noFallthroughCasesInSwitch` enabled
- `forceConsistentCasingInFileNames` enabled

### Type Annotations

Prefer explicit return types for exported functions:

**✅ Good:**
```typescript
export const calculateTotal = (items: Item[]): number => {
  return items.reduce((sum, item) => sum + item.price, 0);
};
```

Use inference for simple internal cases:
```typescript
const count = items.length; // number inferred
```

### Avoid `any`

Use `unknown` for truly unknown types, narrow with type guards:

```typescript
const handleData = (data: unknown) => {
  if (typeof data === 'string') {
    // data is string here
  }
};
```

## Naming Conventions

### Variables & Functions

- **camelCase**: `userName`, `fetchUserData`, `isLoading`
- **Boolean variables**: Prefix with `is`, `has`, `should`
  - `isVisible`, `hasError`, `shouldRender`
- **Event handlers**: Prefix with `handle`
  - `handleClick`, `handleSubmit`, `handleChange`

### Types & Interfaces

- **PascalCase**: `User`, `UserProfile`, `ApiResponse`
- **Props interfaces**: `ComponentNameProps`
  - `ButtonProps`, `HeaderProps`, `LayoutProps`
- **Type aliases**: Same as interfaces, PascalCase

### Components

- **PascalCase**: `UserProfile`, `NavigationBar`, `SkillsSection`
- **One component per file** (except small related components)
- **File naming**: Use component name in PascalCase or kebab-case

### Constants

- **UPPER_SNAKE_CASE**: `MAX_RETRIES`, `API_BASE_URL`, `DEFAULT_TIMEOUT`
- **For true constants only** (not configuration objects)

### Files

- **kebab-case**: `user-profile.tsx`, `use-metadata.ts`, `icon.styles.ts`
- **Test files**: `component-name.test.tsx`
- **Hooks**: `use-hook-name.ts`
- **Styles**: `component-name.styles.ts`

## File Organization

### Project Structure

```
src/
├── resume/           # Resume page components & sections
│   ├── about.tsx
│   ├── education.tsx
│   ├── experience.tsx
│   ├── skills.tsx
│   ├── projects.tsx
│   ├── footer.tsx
│   ├── layout.tsx
│   ├── sidebar.tsx
│   ├── *.styles.ts  # PandaCSS styles
│   └── *.test.tsx   # Component tests
├── icons/            # Icon components & utilities
│   ├── lang-icon.tsx
│   ├── social-icon.tsx
│   ├── use-icon-class.ts
│   └── *.test.tsx
├── routes/           # TanStack Router routes
│   ├── __root.tsx   # Root layout
│   └── index.tsx    # Homepage route
├── test-utils/       # Testing utilities
│   ├── setups/      # Test environment setup
│   ├── mock-metadata.ts
│   └── render-wrapper.tsx
├── img/              # Static images
└── 404/              # 404 page
```

### Test Snapshots

```
__snapshots__/        # Auto-generated by Vitest
└── *.snap           # DO NOT manually edit
```

**Important**: Snapshots are test outputs generated by Vitest. Never manually write to these files.

### Import Order

Organized automatically by Biome:
1. React imports
2. External library imports
3. Internal module imports
4. Type imports (with `import type`)
5. Styles/CSS imports

**Example:**
```typescript
import { useState } from 'react';
import { useRouter } from '@tanstack/react-router';
import { calculateTotal } from '../utils';
import type { User } from '../types';
import { css } from '../../styled-system/css';
```

## Component Structure

### Exports

- **Default export** for page/route components
- **Named exports** for utilities, hooks, types

### Component Pattern

```typescript
export const ComponentName = ({ prop1, prop2 }: ComponentNameProps) => {
  // 1. Hooks first
  const [state, setState] = useState();
  const data = useCustomHook();
  
  // 2. Derived state and computations
  const computedValue = useMemo(() => calculate(data), [data]);
  
  // 3. Event handlers
  const handleClick = () => {
    setState(newValue);
  };
  
  // 4. Effects (if needed)
  useEffect(() => {
    // Side effects
  }, [dependencies]);
  
  // 5. Render logic
  if (isLoading) return <LoadingSpinner />;
  if (error) return <ErrorMessage />;
  
  // 6. Main render
  return <div>...</div>;
};
```

## Comments Philosophy

### General Rule

**Avoid comments unless absolutely necessary.**

Code should be self-documenting through:
- Clear variable names
- Small, focused functions
- Descriptive type definitions

### Good Comments (Explain "Why" and "What")

**✅ Good:**
```typescript
// Cloudflare Pages requires trailing slashes for proper routing
const normalizedPath = path.endsWith('/') ? path : `${path}/`;

// User preferences are cached for 24 hours to reduce API calls
const CACHE_DURATION = 24 * 60 * 60 * 1000;
```

**✅ Good (Complex business logic):**
```typescript
// Calculate adjusted score based on recency bias:
// - Recent items (< 7 days) get 1.5x multiplier
// - Medium age (7-30 days) get 1.0x
// - Older items (> 30 days) get 0.75x multiplier
const adjustedScore = calculateRecencyScore(item);
```

### Bad Comments (Explain "How" - Use Better Variable Names Instead)

**❌ Bad:**
```typescript
// Check if user is admin
if (user.role === 'admin' && user.permissions.includes('write')) {
  // ...
}
```

**✅ Better:**
```typescript
const isAdminWithWriteAccess = 
  user.role === 'admin' && user.permissions.includes('write');

if (isAdminWithWriteAccess) {
  // ...
}
```

**❌ Bad:**
```typescript
// Loop through items and add prices
const total = items.reduce((sum, item) => sum + item.price, 0);
```

**✅ Better:**
```typescript
const totalPrice = items.reduce((sum, item) => sum + item.price, 0);
```

### When Comments Are Acceptable

- Complex algorithms (explain the approach)
- Non-obvious workarounds for browser/framework bugs
- Important constraints or assumptions
- Business logic that's not intuitive
- TODO/FIXME with context (but prefer creating issues)

### JSDoc

Avoid JSDoc unless creating a shared library/utility. TypeScript types provide better documentation than JSDoc.

**Example where JSDoc might be acceptable:**
```typescript
/**
 * Formats a date relative to the current time.
 * Returns "just now", "5 minutes ago", "2 hours ago", etc.
 * 
 * @param date - The date to format
 * @returns Human-readable relative time string
 */
export const formatRelativeTime = (date: Date): string => {
  // Implementation
};
```

## CSS/Styling (PandaCSS)

### Styling Patterns

- Use PandaCSS utilities via `css()` function
- Define reusable styles in `*.styles.ts` files
- Use design tokens from `panda.config.ts`
- Avoid inline styles (use PandaCSS instead)

### File Organization

```
component-name.tsx       # Component logic
component-name.styles.ts # PandaCSS styles (optional)
component-name.test.tsx  # Tests
```

### Example Style File

```typescript
// component.styles.ts
import { css } from '../../styled-system/css';

export const containerStyle = css({
  display: 'flex',
  gap: '1rem',
  padding: '2rem',
  lg: {
    gap: '2rem',
  },
});

export const headingStyle = css({
  fontFamily: 'heading',
  color: 'primary',
  fontSize: '2rem',
});
```

## Code Organization

### Barrel Exports

Avoid barrel exports (index.ts files that re-export everything). Import directly from source files.

**❌ Avoid:**
```typescript
// icons/index.ts
export * from './lang-icon';
export * from './social-icon';
```

**✅ Prefer:**
```typescript
import { LangIcon } from './icons/lang-icon';
import { SocialIcon } from './icons/social-icon';
```

### Function Size

Keep functions small and focused:
- Single responsibility
- Ideally under 50 lines
- Extract complex logic into separate functions

### File Size

Keep files manageable:
- Components: Under 300 lines ideally
- Utilities: Under 200 lines
- If larger, consider splitting into multiple files

## Ignored Files

**DO NOT** edit or commit:
- `styled-system/` - Generated by PandaCSS
- `src/route-tree.gen.ts` - Generated by TanStack Router
- `**/__snapshots__/**` - Generated by Vitest tests
- `node_modules/`
- `dist/`
- `coverage/`

These are auto-generated and will be overwritten.

## Best Practices

### DRY (Don't Repeat Yourself)

Extract repeated code into functions or components:

**✅ Good:**
```typescript
const formatUserName = (user: User) => `${user.firstName} ${user.lastName}`;

// Use in multiple places
<div>{formatUserName(user1)}</div>
<div>{formatUserName(user2)}</div>
```

### Single Responsibility

Each function/component should do one thing:

**❌ Bad:**
```typescript
const UserProfile = () => {
  // Fetches data, handles auth, renders UI, manages forms
};
```

**✅ Better:**
```typescript
const UserProfile = () => {
  const user = useUser();
  return <UserProfileView user={user} />;
};
```

### Early Returns

Use early returns to reduce nesting:

**✅ Good:**
```typescript
const Component = ({ data }: Props) => {
  if (!data) return <NoData />;
  if (data.error) return <Error />;
  
  return <SuccessView data={data} />;
};
```

**❌ Bad:**
```typescript
const Component = ({ data }: Props) => {
  return (
    <>
      {!data ? (
        <NoData />
      ) : data.error ? (
        <Error />
      ) : (
        <SuccessView data={data} />
      )}
    </>
  );
};
```

### Prop Destructuring

Destructure props in function parameters:

**✅ Good:**
```typescript
export const Button = ({ label, onClick, disabled = false }: ButtonProps) => {
  // Use label, onClick, disabled directly
};
```

**❌ Bad:**
```typescript
export const Button = (props: ButtonProps) => {
  return <button onClick={props.onClick}>{props.label}</button>;
};
```
